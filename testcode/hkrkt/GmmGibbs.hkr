[(fn as ((array nat) -> ((array real) -> (nat -> (measure nat)))) [(fn z ((array real) -> (nat -> (measure nat))) [(fn t (nat -> (measure nat)) [(fn docUpdate (measure nat) [(match [(and [(== [(size [z : (array nat)]) : nat] [(size [t : (array real)]) : nat]) : bool][(< [docUpdate : nat] [(size [z : (array nat)]) : nat]) : bool][(< [(index [z : (array nat)] [docUpdate : nat]) : nat] [(size [as : (array prob)]) : nat]) : bool]) : bool] ((pdatum true (pc_inl (ps_done))) [(pose [(* [(realpow [2 : prob] [(+ [(* [(nat2real [(size [t : (array real)]) : nat]) : real][(/ -1 2) : real]) : real][(* [(nat2real [(size [as : (array prob)]) : nat]) : real][(/ 1 2) : real]) : real]) : real]) : prob][(exp [(* [(summate (_a [0 : nat] [(size [t : (array real)]) : nat]) [(natpow [(index [t : (array real)] [_a : nat]) : real] [2 : nat]) : real]) : real][(/ -1 2) : real]) : real]) : prob][(realpow [(pi) : prob] [(* [(nat2real [(size [t : (array real)]) : nat]) : real][(/ -1 2) : real]) : real]) : prob][(product (_b [0 : nat] [(size [as : (array prob)]) : nat]) [(product (j [0 : nat] [(let (summary (array nat) [(bucket [0 : nat] [(size [t : (array real)]) : nat] (r_index [(size [as : (array prob)]) : nat] (bind _a [(index [z : (array nat)] [_a : nat]) : nat]) (r_add (bind _a (bind _b [1 : nat]))))) : (array nat)]) [(int2nat [(+ [(* [(nat2int [(match [(== [_b : nat] [(index [z : (array nat)] [docUpdate : nat]) : nat]) : bool] ((pdatum true (pc_inl (ps_done))) [1 : nat]) ((pdatum false (pc_inr (pc_inl (ps_done)))) [0 : nat])) : nat]) : int][-1 : int]) : int][(nat2int [(index [summary : (array nat)] [_b : nat]) : nat]) : int]) : int]) : nat]) : nat]) [(+ [(nat2prob [j : nat]) : prob][(index [as : (array prob)] [_b : nat]) : prob]) : prob]) : prob]) : prob][(recip [(product (_b [0 : nat] [(summate (_a [0 : nat] [(size [t : (array real)]) : nat]) [(match [(== [_a : nat] [docUpdate : nat]) : bool] ((pdatum true (pc_inl (ps_done))) [0 : nat]) ((pdatum false (pc_inr (pc_inl (ps_done)))) [1 : nat])) : nat]) : nat]) [(+ [(nat2prob [_b : nat]) : prob][(summate (_a [0 : nat] [(size [as : (array prob)]) : nat]) [(index [as : (array prob)] [_a : nat]) : prob]) : prob]) : prob]) : prob]) : prob][(recip [(+ [(nat2prob [(summate (_a [0 : nat] [(size [t : (array real)]) : nat]) [(match [(== [_a : nat] [docUpdate : nat]) : bool] ((pdatum true (pc_inl (ps_done))) [0 : nat]) ((pdatum false (pc_inr (pc_inl (ps_done)))) [1 : nat])) : nat]) : nat]) : prob][(summate (_a [0 : nat] [(size [as : (array prob)]) : nat]) [(index [as : (array prob)] [_a : nat]) : prob]) : prob]) : prob]) : prob]) : prob] [(categorical [(array (zNewb [(size [as : (array prob)]) : nat]) [(real2prob [(* [(prob2real [(exp [(* [(summate (_a [0 : nat] [(size [as : (array prob)]) : nat]) [(* [(natpow [(let (summary (array real) [(bucket [0 : nat] [(size [t : (array real)]) : nat] (r_index [(size [as : (array prob)]) : nat] (bind i [(index [z : (array nat)] [i : nat]) : nat]) (r_add (bind i (bind _a [(index [t : (array real)] [i : nat]) : real]))))) : (array real)]) [(+ [(match [(== [_a : nat] [zNewb : nat]) : bool] ((pdatum true (pc_inl (ps_done))) [(index [t : (array real)] [docUpdate : nat]) : real]) ((pdatum false (pc_inr (pc_inl (ps_done)))) [0 : real])) : real][(* [(match [(== [_a : nat] [(index [z : (array nat)] [docUpdate : nat]) : nat]) : bool] ((pdatum true (pc_inl (ps_done))) [(index [t : (array real)] [docUpdate : nat]) : real]) ((pdatum false (pc_inr (pc_inl (ps_done)))) [0 : real])) : real][-1 : real]) : real][(index [summary : (array real)] [_a : nat]) : real]) : real]) : real] [2 : nat]) : real][(recip [(int2real [(+ [1 : int][(let (summary (array nat) [(bucket [0 : nat] [(size [t : (array real)]) : nat] (r_index [(size [as : (array prob)]) : nat] (bind i [(index [z : (array nat)] [i : nat]) : nat]) (r_add (bind i (bind _a [1 : nat]))))) : (array nat)]) [(+ [(nat2int [(match [(== [_a : nat] [zNewb : nat]) : bool] ((pdatum true (pc_inl (ps_done))) [1 : nat]) ((pdatum false (pc_inr (pc_inl (ps_done)))) [0 : nat])) : nat]) : int][(* [(nat2int [(match [(== [_a : nat] [(index [z : (array nat)] [docUpdate : nat]) : nat]) : bool] ((pdatum true (pc_inl (ps_done))) [1 : nat]) ((pdatum false (pc_inr (pc_inl (ps_done)))) [0 : nat])) : nat]) : int][-1 : int]) : int][(nat2int [(index [summary : (array nat)] [_a : nat]) : nat]) : int]) : int]) : int]) : int]) : real]) : real]) : real]) : real][(/ 1 2) : real]) : real]) : prob]) : real][(prob2real [(recip [(root [(nat2prob [(int2nat [(product (_b [0 : nat] [(size [as : (array prob)]) : nat]) [(+ [2 : int][(* [(let (summary (array nat) [(bucket [0 : nat] [(size [t : (array real)]) : nat] (r_index [(size [as : (array prob)]) : nat] (bind _a [(index [z : (array nat)] [_a : nat]) : nat]) (r_add (bind _a (bind _b [1 : nat]))))) : (array nat)]) [(+ [(nat2int [(match [(== [_b : nat] [zNewb : nat]) : bool] ((pdatum true (pc_inl (ps_done))) [1 : nat]) ((pdatum false (pc_inr (pc_inl (ps_done)))) [0 : nat])) : nat]) : int][(* [(nat2int [(match [(== [_b : nat] [(index [z : (array nat)] [docUpdate : nat]) : nat]) : bool] ((pdatum true (pc_inl (ps_done))) [1 : nat]) ((pdatum false (pc_inr (pc_inl (ps_done)))) [0 : nat])) : nat]) : int][-1 : int]) : int][(nat2int [(index [summary : (array nat)] [_b : nat]) : nat]) : int]) : int]) : int][2 : int]) : int]) : int]) : int]) : nat]) : prob] [2 : nat]) : prob]) : prob]) : real][(+ [(int2real [(let (summary (array nat) [(bucket [0 : nat] [(size [t : (array real)]) : nat] (r_index [(size [as : (array prob)]) : nat] (bind _a [(index [z : (array nat)] [_a : nat]) : nat]) (r_add (bind _a (bind zNewb [1 : nat]))))) : (array nat)]) [(+ [(* [(nat2int [(match [(== [zNewb : nat] [(index [z : (array nat)] [docUpdate : nat]) : nat]) : bool] ((pdatum true (pc_inl (ps_done))) [1 : nat]) ((pdatum false (pc_inr (pc_inl (ps_done)))) [0 : nat])) : nat]) : int][-1 : int]) : int][(nat2int [(index [summary : (array nat)] [zNewb : nat]) : nat]) : int]) : int]) : int]) : real][(prob2real [(index [as : (array prob)] [zNewb : nat]) : prob]) : real]) : real]) : real]) : prob]) : (array prob)]) : (measure nat)]) : (measure nat)]) ((pdatum false (pc_inr (pc_inl (ps_done)))) [(match [(not [(== [(size [z : (array nat)]) : nat] [(size [t : (array real)]) : nat]) : bool]) : bool] ((pdatum true (pc_inl (ps_done))) [(reject) : (measure nat)]) ((pdatum false (pc_inr (pc_inl (ps_done)))) [(match [(not [(< [docUpdate : nat] [(size [z : (array nat)]) : nat]) : bool]) : bool] ((pdatum true (pc_inl (ps_done))) [(reject) : (measure nat)]) ((pdatum false (pc_inr (pc_inl (ps_done)))) [(reject) : (measure nat)])) : (measure nat)])) : (measure nat)])) : (measure nat)]) : (nat -> (measure nat))]) : ((array real) -> (nat -> (measure nat)))]) : ((array nat) -> ((array real) -> (nat -> (measure nat))))]) : ((array prob) -> ((array nat) -> ((array real) -> (nat -> (measure nat)))))]
